#!/usr/bin/env python
##
# print basic passivetotal results for a list of domains/IPs
# first seen, last seen, resolutions
# requires PassiveTotal API key
# --
# adam m. swanda
# https://github.com/deadbits/malware-analysis-scripts
# http://www.deadbits.org
##

import os
import sys
import argparse

from passivetotal import PassiveTotal


def read_list(file_name):
    data = [ line.strip() for line in open(file_name, 'rb') ]
    return data


if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('-l', '--list', help='list of indicators to check in PassiveTotal', action='store', required=True)
    parser.add_argument('-a', '--apikey', help='PassiveTotal API key', action='store', required=True)
    args = parser.parse_args()

    if not os.path.exists(args.list):
        print 'error: file %s not found' % args.list
        sys.exit(1)

    iocs = read_list(args.list)
    print 'Domains:\t%d\n' % len(iocs)

    pt = PassiveTotal(args.apikey)

    for host in iocs:
        resp = pt.get_passive(host)
        if resp['success']:
            print 'First:\t%s' % resp['results']['first_seen']
            print 'Last: \t%s' % resp['results']['last_seen']
            print 'Hosts:\n'
            r = resp['results']
            for d in r['records']:
                print "\t%s" % d['resolve']





